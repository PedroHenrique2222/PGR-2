<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notícia - Portal GR</title>
    <meta name="description" content="Acompanhe as últimas notícias de Estância Velha e região.">
    <link rel="icon" type="image/png" href="Imagens/FV.png">
    
    <!-- Bibliotecas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Merriweather:ital,wght@0,300;0,400;0,700;1,300&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <link rel="stylesheet" href="styles/style.css">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                    serif: ['Merriweather', 'serif'],
                },
                extend: {
                    colors: {
                        'primary': '#0D47A1', 'primary-dark': '#1565C0',
                        'light-bg': '#F7FAFC', 'dark-bg': '#1A202C',
                        'dark-card': '#2D3748'
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos do Conteúdo da Notícia */
        .news-content {
            font-family: 'Merriweather', serif;
            font-size: 1.125rem;
            line-height: 1.8;
            color: #374151; /* Gray-700 */
        }
        .dark .news-content { color: #d1d5db; /* Gray-300 */ }

        /* Imagens no Texto */
        .news-content img {
            max-width: 100%;
            height: auto !important;
            border-radius: 0.5rem;
            margin: 1.5rem 0;
        }

        /* Alinhamentos (Flutuação) */
        .news-content img[style*="float: left"], .news-content img[align="left"] {
            float: left; margin-right: 1.5rem; margin-bottom: 1rem; clear: left;
        }
        .news-content img[style*="float: right"], .news-content img[align="right"] {
            float: right; margin-left: 1.5rem; margin-bottom: 1rem; clear: right;
        }
        .news-content img[style*="display: block"], .news-content .ql-align-center img {
            margin: 1.5rem auto; display: block;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .news-content img[style*="float: left"], .news-content img[style*="float: right"] {
                float: none !important; display: block; margin: 1.5rem auto; width: 100% !important;
            }
        }

        /* Elementos de Texto */
        .news-content p { margin-bottom: 1.2rem; }
        .news-content h2 { font-family: 'Inter', sans-serif; font-weight: 800; font-size: 1.8rem; margin-top: 2.5rem; margin-bottom: 1rem; color: #111827; }
        .news-content h3 { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 1.5rem; margin-top: 2rem; margin-bottom: 0.8rem; color: #1f2937; }
        .dark .news-content h2, .dark .news-content h3 { color: #f3f4f6; }
        .news-content blockquote { border-left: 4px solid #0D47A1; padding-left: 1rem; margin: 1.5rem 0; font-style: italic; color: #4b5563; background: #f9fafb; padding: 1rem; border-radius: 0 0.5rem 0.5rem 0; }
        .dark .news-content blockquote { border-color: #63B3ED; color: #9ca3af; background: #2d3748; }
        .news-content a { color: #0D47A1; text-decoration: underline; font-weight: 600; }
        .dark .news-content a { color: #63B3ED; }
        .news-content iframe { width: 100%; aspect-ratio: 16/9; border-radius: 0.5rem; margin: 2rem 0; }
        .news-content::after { content: ""; display: table; clear: both; }

        /* LÓGICA DE INVERSÃO DA LOGO (Igual ao Index) */
        html:not(.dark) .logo-img {
            filter: invert(1);
        }
        .dark .logo-img {
            filter: none;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 dark:bg-dark-bg dark:text-gray-100 transition-colors duration-300">

    <div id="progress-bar" class="fixed top-0 left-0 z-[60] h-1.5 bg-gradient-to-r from-primary to-blue-400 transition-all duration-100 ease-linear w-0"></div>

    <header class="bg-white dark:bg-dark-card shadow-sm border-b border-gray-200 dark:border-gray-700 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="index.html" class="flex items-center gap-3 group">
                    <!-- LOGO CORRIGIDA COM CLASSE logo-img -->
                    <img src="Imagens/FV.png" alt="Logo Portal GR" class="logo-img w-10 h-10 object-cover rounded-full border border-gray-100 dark:border-gray-600 shadow-sm">
                    <span class="font-bold text-xl tracking-tight text-gray-800 dark:text-white group-hover:text-primary dark:group-hover:text-blue-400 transition-colors">Portal GR</span>
                </a>
                <nav class="hidden md:flex items-center gap-6 text-sm font-medium">
                    <a href="index.html" class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white transition-colors">Início</a>
                    <a href="index.html#noticias" class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-white transition-colors">Notícias</a>
                    <!-- Seção "Editorias" removida -->
                </nav>
                <div class="flex items-center gap-3">
                    <button id="theme-toggle" class="p-2 text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors"><i id="theme-icon" class="fas fa-moon"></i></button>
                    <button id="mobile-menu-button" class="md:hidden p-2 text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg"><i class="fas fa-bars fa-lg"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white dark:bg-dark-card border-t border-gray-200 dark:border-gray-700"></div>
    </header>

    <!-- CONTEÚDO PRINCIPAL (ESTRUTURA CLÁSSICA) -->
    <main id="news-article-container" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-10 hidden">
        
        <!-- Breadcrumb -->
        <nav class="text-sm text-gray-500 dark:text-gray-400 mb-6">
            <a href="index.html" class="hover:text-primary dark:hover:text-blue-400 hover:underline">Início</a> 
            <span class="mx-2">/</span>
            <a href="index.html#noticias" class="hover:text-primary dark:hover:text-blue-400 hover:underline">Notícias</a>
            <span class="mx-2">/</span>
            <span id="breadcrumb-category" class="font-semibold text-gray-800 dark:text-white"></span>
        </nav>

        <!-- Cabeçalho (Título, Subtítulo, Data) -->
        <header class="mb-8">
            <h1 id="news-title" class="text-3xl md:text-5xl font-extrabold text-gray-900 dark:text-white leading-tight mb-4 font-sans"></h1>
            <p id="news-subtitle" class="text-xl text-gray-600 dark:text-gray-300 font-light leading-relaxed mb-6"></p>
            
            <div class="flex items-center gap-3 text-sm text-gray-500 dark:text-gray-400 border-b border-gray-200 dark:border-gray-700 pb-6">
                <i class="far fa-calendar-alt"></i>
                <span id="news-date"></span>
            </div>
        </header>

        <!-- Imagem Principal (Sem overlays, simples e direta) -->
        <figure class="mb-10">
            <img id="news-image" src="" alt="Capa da notícia" class="w-full rounded-xl shadow-md bg-gray-200 dark:bg-gray-800 object-cover" style="max-height: 600px;">
            <figcaption id="image-credit" class="text-xs text-gray-500 dark:text-gray-400 mt-2 text-right italic"></figcaption>
        </figure>

        <!-- Corpo do Texto -->
        <article id="news-content" class="news-content mb-12">
            <!-- Conteúdo injetado aqui -->
        </article>
        
        <!-- Tags -->
        <div class="border-t border-gray-200 dark:border-gray-700 pt-6 mb-10">
            <h4 class="text-sm font-bold text-gray-500 dark:text-gray-400 uppercase mb-3">Tópicos:</h4>
            <div id="tags-container" class="flex flex-wrap gap-2"></div>
        </div>

        <!-- Compartilhar -->
        <div class="bg-gray-50 dark:bg-dark-card border border-gray-100 dark:border-gray-700 rounded-xl p-6 text-center mb-16">
            <h3 class="font-bold text-gray-800 dark:text-white mb-4">Compartilhe esta notícia</h3>
            <div id="share-buttons" class="flex justify-center gap-4 flex-wrap"></div>
        </div>

        <!-- Relacionadas -->
        <div id="related-news-section" class="border-t border-gray-200 dark:border-gray-700 pt-10">
            <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-8">Veja também</h3>
            <div id="related-news" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </div>
    </main>
    
    <div id="loading-indicator" class="min-h-screen flex flex-col justify-center items-center bg-white dark:bg-dark-bg fixed inset-0 z-50">
        <div class="w-16 h-16 border-4 border-gray-200 border-t-primary rounded-full animate-spin mb-4"></div>
        <p class="text-gray-500 animate-pulse">Carregando...</p>
    </div>

    <div id="error-message" class="hidden min-h-screen flex flex-col justify-center items-center text-center px-4">
        <i class="fas fa-exclamation-circle text-gray-300 text-6xl mb-6"></i>
        <h2 class="text-2xl font-bold mb-4 dark:text-white">Ops!</h2>
        <p class="text-gray-500 mb-8 max-w-md">Não conseguimos encontrar essa notícia.</p>
        <a href="index.html" class="bg-primary text-white font-bold py-3 px-8 rounded-lg hover:bg-primary-dark transition-colors shadow-lg">Voltar</a>
    </div>

    <footer class="bg-white dark:bg-dark-card border-t border-gray-200 dark:border-gray-700 py-12 mt-auto">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-gray-500 text-sm">&copy; 2025 Portal GR.</p>
        </div>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, query, where, limit, orderBy, documentId, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDlV94hvPy5NIi6zCoSihsaMmoprudmaWQ",
            authDomain: "portal-noticias-ruda.firebaseapp.com",
            projectId: "portal-noticias-ruda",
            storageBucket: "portal-noticias-ruda.appspot.com",
            messagingSenderId: "520724881912",
            appId: "1:520724881912:web:a9f207b3235328cf34b60d"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        const loading = document.getElementById('loading-indicator');
        const errorMsg = document.getElementById('error-message');
        const container = document.getElementById('news-article-container');

        async function loadNewsArticle() {
            const params = new URLSearchParams(window.location.search);
            const newsId = params.get('id');
            const isPreview = params.get('preview') === 'true';

            if (isPreview) {
                const data = JSON.parse(sessionStorage.getItem('newsPreview'));
                if (data) renderPage({ ...data, createdAt: new Date() });
                else showError();
                return;
            }

            if (!newsId) return showError();
            
            try {
                const docSnap = await getDoc(doc(db, "news", newsId));
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    renderPage({ ...data, createdAt: data.createdAt?.toDate() || new Date(), id: docSnap.id });
                    loadRelated(data.category, newsId);
                } else {
                    showError();
                }
            } catch (error) {
                console.error(error);
                showError();
            }
        }

        function renderPage(data) {
            document.title = `${data.title} - Portal GR`;
            document.querySelector('meta[name="description"]')?.setAttribute("content", data.subtitle || data.title);
            
            document.getElementById('breadcrumb-category').textContent = data.category || 'Geral';
            document.getElementById('news-date').textContent = data.createdAt.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long', year: 'numeric' });
            document.getElementById('news-title').textContent = data.title;
            document.getElementById('news-subtitle').textContent = data.subtitle || '';
            
            const img = document.getElementById('news-image');
            img.src = data.imageUrl || 'https://placehold.co/1200x600/f3f4f6/a3a3a3?text=Sem+Imagem';
            img.alt = data.title;
            
            document.getElementById('image-credit').textContent = data.imageCredit ? `Foto: ${data.imageCredit}` : '';
            document.getElementById('news-content').innerHTML = data.content;
            
            const tagContainer = document.getElementById('tags-container');
            if (data.tags?.length) {
                tagContainer.innerHTML = data.tags.map(t => 
                    `<span class="bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 px-3 py-1 rounded text-sm font-medium">#${t}</span>`
                ).join('');
            } else {
                tagContainer.innerHTML = '<span class="text-sm text-gray-400">Sem tópicos</span>';
            }

            setupShare(data.title);
            loading.classList.add('hidden');
            container.classList.remove('hidden');
        }

        async function loadRelated(cat, currentId) {
            if(!cat) return;
            const q = query(collection(db, "news"), where("category", "==", cat), where(documentId(), "!=", currentId), limit(3));
            const snap = await getDocs(q);
            const container = document.getElementById('related-news');
            
            if (snap.empty) {
                document.getElementById('related-news-section').classList.add('hidden');
                return;
            }

            snap.forEach(doc => {
                const n = doc.data();
                container.innerHTML += `
                    <a href="noticia.html?id=${doc.id}" class="group block bg-white dark:bg-dark-card border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden hover:shadow-lg transition-all">
                        <div class="h-48 overflow-hidden">
                            <img src="${n.imageUrl || 'https://placehold.co/600x400'}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                        </div>
                        <div class="p-4">
                            <span class="text-xs text-primary font-bold uppercase">${n.category}</span>
                            <h4 class="font-bold text-gray-800 dark:text-white mt-2 group-hover:text-primary transition-colors line-clamp-2">${n.title}</h4>
                        </div>
                    </a>
                `;
            });
        }

        function setupShare(title) {
            const url = encodeURIComponent(window.location.href);
            const text = encodeURIComponent(title);
            const buttons = [
                { icon: 'fab fa-whatsapp', color: 'bg-green-500', link: `https://api.whatsapp.com/send?text=${text}%20${url}` },
                { icon: 'fab fa-facebook-f', color: 'bg-blue-600', link: `https://www.facebook.com/sharer/sharer.php?u=${url}` },
                { icon: 'fab fa-twitter', color: 'bg-black', link: `https://twitter.com/intent/tweet?url=${url}&text=${text}` },
                { icon: 'far fa-envelope', color: 'bg-gray-500', link: `mailto:?subject=${text}&body=${url}` }
            ];
            
            document.getElementById('share-buttons').innerHTML = buttons.map(b => 
                `<a href="${b.link}" target="_blank" class="w-12 h-12 rounded-full ${b.color} text-white flex items-center justify-center text-xl hover:-translate-y-1 transition-transform shadow-md"><i class="${b.icon}"></i></a>`
            ).join('');
        }

        function showError() {
            loading.classList.add('hidden');
            errorMsg.classList.remove('hidden');
        }

        window.onscroll = () => {
            const winScroll = document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById("progress-bar").style.width = scrolled + "%";
        };

        // Função initMenu simplificada (sem dropdown de editorias)
        async function initMenu() {
            const mobile = document.getElementById('mobile-menu');
            
            // Construir apenas o menu mobile com links fixos ou dinâmicos se necessário
            mobile.innerHTML = `
                <nav class="flex flex-col p-4 space-y-2">
                    <a href="index.html" class="p-2 hover:bg-gray-100 rounded dark:text-white">Início</a>
                    <a href="index.html#noticias" class="p-2 hover:bg-gray-100 rounded dark:text-white">Notícias</a>
                </nav>
            `;
        }

        loadNewsArticle();
        initMenu();
    </script>
    <script src="scripts/main.js"></script>
</body>
</html>